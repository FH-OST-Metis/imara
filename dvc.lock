schema: '2.0'
stages:
  extract:
    cmd: uv run python src/app/extract.py --input data/raw/documents --output 
      data/processed/extracted
    deps:
    - path: data/raw/documents
      hash: md5
      md5: b99cf919d7316a6142a381d38dce66a6.dir
      size: 3615190939
      nfiles: 1001
    - path: src/app/extract.py
      hash: md5
      md5: ad4d553b94723e18e22baeb9bdea90e1
      size: 15715
    params:
      params.yaml:
        extract.batch_size: 1
        extract.source_handling: copy
    outs:
    - path: data/processed/extracted
      hash: md5
      md5: 2b597a1b3021010b926d35600555ddc4.dir
      size: 27059869438
      nfiles: 12955
  chunk:
    cmd: uv run python src/app/chunk.py --input data/processed/extracted 
      --output data/processed/chunks
    deps:
    - path: data/processed/extracted
      hash: md5
      md5: 4065efd980e1243efa3506a32f8c9882.dir
      size: 5086187
      nfiles: 6
    - path: src/app/chunk.py
      hash: md5
      md5: f8aeab456396f072ffebffae7e2b1ed1
      size: 3531
    params:
      params.yaml:
        chunk.chunk_size: 500
        chunk.overlap: 100
        chunk.split_by: section
    outs:
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
  embed:
    cmd: uv run python src/app/embed.py --input data/processed/chunks 
      --artifacts data/processed/extracted --database_url 
      postgresql://postgres:postgres@127.0.0.1:54322/postgres
    deps:
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
    - path: data/processed/extracted
      hash: md5
      md5: 4065efd980e1243efa3506a32f8c9882.dir
      size: 5086187
      nfiles: 6
    - path: src/app/embed.py
      hash: md5
      md5: 7d8ab6ac7c1849135050a89d6ec03655
      size: 4048
  prep_pipeline:
    cmd: uv run python src/app/prep_pipeline.py
    deps:
    - path: src/app/prep_pipeline.py
      hash: md5
      md5: f8e253bdb6de39aea0139c07679e299b
      size: 1266
  graphmert_train:
    cmd: uv run python src/app/graphmert_train.py
    deps:
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
    - path: src/app/graphmert_train.py
      hash: md5
      md5: 217026f724d33bea92e12e5f876af678
      size: 8961
    outs:
    - path: data/graphmert
      hash: md5
      md5: d449581375fd3369d52728f27e6be305.dir
      size: 15141258
      nfiles: 3
  graphmert_corpus:
    cmd: uv run python src/app/graphmert/corpus.py
    deps:
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
    - path: src/app/graphmert/corpus.py
      hash: md5
      md5: c54a70b3aaf748e08f8f3356f81e920d
      size: 1338
    outs:
    - path: data/graphmert/corpus
      hash: md5
      md5: 02249e47e4fcf103b5f739273adb334f.dir
      size: 24852
      nfiles: 1
  graphmert_embeddings:
    cmd: uv run python src/app/graphmert/embeddings.py
    deps:
    - path: data/graphmert/corpus/corpus.json
      hash: md5
      md5: 07506ed73ea78de0b35d8c3fd05e1146
      size: 24852
    - path: src/app/graphmert/embeddings.py
      hash: md5
      md5: cf77a6a5f18868dfdf0bc4979a122a85
      size: 2798
    outs:
    - path: data/graphmert/embeddings
      hash: md5
      md5: b36b46ccd948015050b9e19bcc8e20d7.dir
      size: 1848
      nfiles: 1
  graphmert_build_graphs:
    cmd: uv run python src/app/graphmert/build_graphs.py
    deps:
    - path: data/graphmert/embeddings/reduced_embeddings.npy
      hash: md5
      md5: 457e35efe4bf0764ad0c1bf0604e4718
      size: 1848
    - path: src/app/graphmert/build_graphs.py
      hash: md5
      md5: d3b87f270941fbcaef341a027756ccea
      size: 1622
    outs:
    - path: data/graphmert/graphs
      hash: md5
      md5: 6f1d985bbb1b7eb256fdfd27cbfa9ad3.dir
      size: 14478
      nfiles: 1
  graphmert_train_model:
    cmd: uv run python src/app/graphmert/train_model.py
    deps:
    - path: data/graphmert/graphs/sentence_transformer_fixed10d_graphs.json
      hash: md5
      md5: 461866e091a2f6adc5dedb9ec120fd4a
      size: 14478
    - path: src/app/graphmert/train_model.py
      hash: md5
      md5: b9812435d9fc2fe12ff73676c686d20c
      size: 6298
    outs:
    - path: data/graphmert/model
      hash: md5
      md5: 4709ef346d85f713981060fb6613a8d9.dir
      size: 15126780
      nfiles: 2
  naiverag_chunk:
    cmd: uv run python src/app/naiverag/chunk.py --input 
      data/processed/extracted --output data/processed/chunks
    deps:
    - path: data/processed/extracted
      hash: md5
      md5: 2b597a1b3021010b926d35600555ddc4.dir
      size: 27163434807
      nfiles: 12955
    - path: src/app/naiverag/chunk.py
      hash: md5
      md5: dd784bc94e1b3a2ded7b6a482559241c
      size: 3810
    params:
      params.yaml:
        chunk.chunk_size: 500
        chunk.overlap: 100
        chunk.split_by: section
    outs:
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
  naiverag_embed:
    cmd: uv run python src/app/naiverag/embed.py --input data/processed/chunks 
      --artifacts data/processed/extracted --database_url 
      postgresql://postgres:postgres@127.0.0.1:54322/postgres
    deps:
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
    - path: data/processed/extracted
      hash: md5
      md5: 2b597a1b3021010b926d35600555ddc4.dir
      size: 27163434807
      nfiles: 12955
    - path: src/app/naiverag/embed.py
      hash: md5
      md5: c92b40b2a35e51b7e4a32a9e989c2e3f
      size: 4347
  generate_queries:
    cmd: uv run open-rag-eval generate-queries --config query_gen_config.yaml
    deps:
    - path: data/processed/extracted
      hash: md5
      md5: 2b597a1b3021010b926d35600555ddc4.dir
      size: 27163434807
      nfiles: 12955
    - path: query_gen_config.yaml
      hash: md5
      md5: 989df0e1fbceb07aeea8de44d74e7fe6
      size: 1394
    params:
      query_gen_config.yaml:
        generation.n_questions: 10
        generation.questions_per_doc: 10
        model.name: models/gemini-2.5-flash
        model.type: GeminiModel
    outs:
    - path: data/eval/queries.csv
      hash: md5
      md5: e9db32d9fdc0df8a73c6aa87d81b194b
      size: 1207
  graphmert_generate_answers:
    cmd: uv run python src/app/eval_open_rag.py --system graphmert --queries 
      data/eval/queries.csv --output data/eval/graphmert/generated_answers.csv
    deps:
    - path: data/eval/queries.csv
      hash: md5
      md5: e9db32d9fdc0df8a73c6aa87d81b194b
      size: 1207
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
    - path: src/app/eval_open_rag.py
      hash: md5
      md5: 1e99facbdbf1c062f37fa859c364a8af
      size: 13152
    - path: src/app/graphmert/corpus.py
      hash: md5
      md5: c54a70b3aaf748e08f8f3356f81e920d
      size: 1338
    - path: src/app/graphmert/inference.py
      hash: md5
      md5: 22f2d1f26f315c34a1cca37edd1b1b95
      size: 7456
    - path: src/app/graphmert/train_model.py
      hash: md5
      md5: b9812435d9fc2fe12ff73676c686d20c
      size: 6298
    - path: src/app/utils/params_helper.py
      hash: md5
      md5: 0388a1d417c9cd336f1a1f7f6b2cdc1e
      size: 232
    params:
      params.yaml:
        eval.top_k: 5
    outs:
    - path: data/eval/graphmert/generated_answers.csv
      hash: md5
      md5: 6228497163931c6fb436368d51cdcda9
      size: 54880
  naiverag_generate_answers:
    cmd: uv run python src/app/eval_open_rag.py --system naiverag --queries 
      data/eval/queries.csv --output data/eval/naiverag/generated_answers.csv
    deps:
    - path: data/eval/queries.csv
      hash: md5
      md5: e9db32d9fdc0df8a73c6aa87d81b194b
      size: 1207
    - path: data/processed/chunks
      hash: md5
      md5: c95209faeebd9dcd59855b660db4052a.dir
      size: 24551
      nfiles: 43
    - path: src/app/embedder.py
      hash: md5
      md5: 00d6dc25817cb92788d8b8a73ba57dd3
      size: 4126
    - path: src/app/eval_open_rag.py
      hash: md5
      md5: 1e99facbdbf1c062f37fa859c364a8af
      size: 13152
    - path: src/app/utils/params_helper.py
      hash: md5
      md5: 0388a1d417c9cd336f1a1f7f6b2cdc1e
      size: 232
    params:
      params.yaml:
        eval.top_k: 5
    outs:
    - path: data/eval/naiverag/generated_answers.csv
      hash: md5
      md5: 17728d1ae96bda331eec10aa24f35eb9
      size: 104020
  graphmert_eval:
    cmd: uv run open-rag-eval eval --config configs/open_rag_eval_graphmert.yaml
    deps:
    - path: configs/open_rag_eval_graphmert.yaml
      hash: md5
      md5: 5942adc6230c787fec4d9e4d80df4152
      size: 766
    - path: data/eval/graphmert/generated_answers.csv
      hash: md5
      md5: 6228497163931c6fb436368d51cdcda9
      size: 54880
    - path: data/eval/queries.csv
      hash: md5
      md5: e9db32d9fdc0df8a73c6aa87d81b194b
      size: 1207
    params:
      configs/open_rag_eval_graphmert.yaml:
        evaluator.0.model.name: gemini-2.5-flash
        evaluator.0.model.type: GeminiModel
        evaluator.0.options.k_values:
        - 1
        - 3
        - 5
    outs:
    - path: data/eval/graphmert/TRECEvaluator-metrics.png
      hash: md5
      md5: 67e18dd0a4f7d9678712b1ec24ea1e5a
      size: 305552
    - path: data/eval/graphmert/results.csv
      hash: md5
      md5: 28fc7d1e285b064ca1b3dd37f38af8df
      size: 58998
  naiverag_eval:
    cmd: uv run open-rag-eval eval --config configs/open_rag_eval_naiverag.yaml
    deps:
    - path: configs/open_rag_eval_naiverag.yaml
      hash: md5
      md5: fc4ca7b0dd05cf6e89fc71a487f0981a
      size: 784
    - path: data/eval/naiverag/generated_answers.csv
      hash: md5
      md5: 17728d1ae96bda331eec10aa24f35eb9
      size: 104020
    - path: data/eval/queries.csv
      hash: md5
      md5: e9db32d9fdc0df8a73c6aa87d81b194b
      size: 1207
    params:
      configs/open_rag_eval_naiverag.yaml:
        evaluator.0.model.name: gemini-2.5-flash
        evaluator.0.model.type: GeminiModel
        evaluator.0.options.k_values:
        - 1
        - 3
        - 5
    outs:
    - path: data/eval/naiverag/TRECEvaluator-metrics.png
      hash: md5
      md5: 4eef9104cb4bfe4c33c9aad3e899a7d5
      size: 303381
    - path: data/eval/naiverag/results.csv
      hash: md5
      md5: 5cf37c246ba7f194987a0ec63165234f
      size: 115760
